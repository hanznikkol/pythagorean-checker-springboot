<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pythagorean</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
    <body class="bg-dark text-light">
        <div class="container py-5">

            <!-- Header with History button -->
            <div class="d-flex justify-content-end mb-4">
                <button id="historyBtn" class="btn btn-info">History</button>
            </div>

            <!-- Title -->
            <h1 class="text-center text-info mb-4 fw-bold">Pythagorean Checker</h1>

            <!-- Input and buttons -->
            <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
                <input id="numberInput" type="number" placeholder="Enter a number" class="form-control w-auto">
                <button id="checkBtn" class="btn btn-primary">Check</button>
                <button id="clearBtn" class="btn btn-danger">Reset</button>
            </div>

            <!-- Results Table -->
            <div class="table-responsive mb-4" style="max-height: 500px; overflow-y: auto;">
                <table class="table table-dark table-striped table-bordered align-middle text-center">
                    <thead class="table-secondary text-dark position-sticky top-0">
                    <tr>
                        <th>Input</th>
                        <th>A</th>
                        <th>B</th>
                        <th>C</th>
                        <th>AVG</th>
                    </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                    <!-- Rows dynamically added -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- History Modal -->
        <div class="modal fade" id="historyModal" tabindex="-1" aria-labelledby="historyModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header">
                        <h5 class="modal-title text-info" id="historyModalLabel">History</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive" style="max-height: 400px; overflow-y:auto;">
                            <table class="table table-dark table-striped table-bordered text-center align-middle mb-0">
                                <thead class="table-secondary text-dark position-sticky top-0">
                                <tr>
                                    <th>Input</th>
                                    <th>A</th>
                                    <th>B</th>
                                    <th>C</th>
                                    <th>AVG</th>
                                    <th>Created At</th>
                                </tr>
                                </thead>
                                <tbody id="historyTableBody">
                                <!-- Rows dynamically added -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
    <script>
        document.getElementById("checkBtn").addEventListener("click", function () {
            const value = document.getElementById("numberInput").value;
            fetch(`/api/check?value=${value}`)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("resultsTableBody");
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${value}</td>
                    <td>${data.A ?? ""}</td>
                    <td>${data.B ?? ""}</td>
                    <td>${data.C ?? ""}</td>
                    <td>${data.AVG ?? ""}</td>
                `;
                    tbody.prepend(row);
                });
        });

        // Clear Button
        document.getElementById("clearBtn").addEventListener("click", () => {
            document.getElementById("numberInput").value = "";
            document.getElementById("resultsTableBody").innerHTML = "";
        });

        // History button
        const historyModal = new bootstrap.Modal(document.getElementById('historyModal'));
        document.getElementById("historyBtn").addEventListener("click", () => {
            fetch("/api/history")
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("historyTableBody");
                    tbody.innerHTML = "";
                    data.forEach(item => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                        <td>${item.inputValue ?? ""}</td>
                        <td>${item.a ?? ""}</td>
                        <td>${item.b ?? ""}</td>
                        <td>${item.c ?? ""}</td>
                        <td>${item.avg ?? ""}</td>
                        <td>${item.createdAt ?? ""}</td>
                    `;
                        tbody.appendChild(row);
                    });
                    historyModal.show();
                });
        });

    </script>


    </body>
</html>